# 스팸 방지 계획 (A Plan for Spam)

무언가를 만드는 것을 좋아하시나요? Hacker News를 이용해보세요.

2002년 8월

(이 글은 우리가 Arc를 사용하여 구축한 웹 기반 메일 리더에서 사용된 스팸 필터링 기법을 설명합니다. 개선된 알고리즘은 '더 나은 베이지안 필터링(Better Bayesian Filtering)'에서 설명합니다.)

스팸을 막는 것이 가능하다고 생각하며, 콘텐츠 기반 필터가 그 방법을 제공할 것입니다. 스패머들의 아킬레스건은 그들의 메시지입니다. 그들은 당신이 설정하는 다른 모든 장벽을 우회할 수 있습니다. 적어도 지금까지는 그랬습니다. 하지만 그들은 어떤 메시지든 전달해야 합니다. 만약 우리가 그들의 메시지를 인식하는 소프트웨어를 작성할 수 있다면, 그들이 그것을 피할 방법은 없을 것입니다.

---

받는 사람의 입장에서 스팸은 쉽게 인식됩니다. 만약 누군가를 고용해서 당신의 메일을 읽고 스팸을 버리게 한다면, 그들은 별 어려움 없이 그 일을 해낼 것입니다. 이 과정을 자동화하기 위해 인공지능(AI)을 제외하고 얼마나 많은 노력이 필요할까요?

저는 꽤 단순한 알고리즘으로 이 문제를 해결할 수 있을 것이라고 생각합니다. 실제로, 개별 단어들의 스팸 확률을 베이지안 방식으로 결합하는 것만으로도 현재의 스팸을 괜찮은 수준으로 필터링할 수 있다는 것을 발견했습니다. 약간 조정된 (아래 설명된) 베이지안 필터를 사용하면, 우리는 현재 1000건의 스팸당 5건 미만의 스팸을 놓치고 있으며, 오탐(false positives)은 0건입니다.

통계적 접근 방식은 사람들이 스팸 필터를 작성할 때 보통 처음 시도하는 방식이 아닙니다. 대부분의 해커들의 첫 번째 본능은 개별 스팸 특징을 인식하는 소프트웨어를 작성하려고 하는 것입니다. 당신은 스팸을 보고 이렇게 생각할 것입니다. "이런, 'Dear Friend'로 시작하거나 제목이 전부 대문자이고 느낌표 여덟 개로 끝나는 메일을 나에게 보내다니, 정말 대담하군." 당신은 한 줄의 코드로 그런 것들을 걸러낼 수 있습니다.

그리고 당신은 그렇게 합니다. 처음에는 효과가 있습니다. 몇 가지 간단한 규칙으로 수신하는 스팸의 상당 부분을 제거할 수 있습니다. 단순히 "click"이라는 단어를 찾는 것만으로도 제 스팸 코퍼스에 있는 이메일의 79.7%를 잡아낼 수 있으며, 오탐은 1.2%에 불과합니다.

저는 통계적 접근 방식을 시도하기 전에 약 6개월 동안 개별 스팸 특징을 찾는 소프트웨어를 작성하는 데 시간을 보냈습니다. 제가 발견한 것은 나머지 몇 퍼센트의 스팸을 인식하는 것이 매우 어려워졌고, 필터를 더 엄격하게 만들수록 오탐이 더 많이 발생한다는 것이었습니다.

오탐이란 잘못 식별되어 스팸으로 분류된 정상적인 이메일을 말합니다. 대부분의 사용자에게 합법적인 이메일을 놓치는 것은 스팸을 받는 것보다 규모 면에서 훨씬 더 나쁜 일입니다. 따라서 오탐을 발생시키는 필터는 환자에게 사망 위험을 안고 가는 여드름 치료제와 같습니다. 사용자가 받을수록 스팸 폴더에 있는 정상적인 메일을 발견할 가능성이 줄어듭니다. 그리고 이상하게도, 스팸 필터가 좋아질수록 오탐은 더 위험해집니다. 필터가 정말 좋으면, 사용자는 자신이 잡은 모든 것을 무시하는 경향이 있기 때문입니다.

제가 왜 통계적 접근 방식을 오랫동안 시도하지 않았는지 모르겠습니다. 아마도 스패머들과 경쟁하는 듯한 기분으로 스팸 특징을 직접 식별하려는 것에 중독되었기 때문일 것입니다. (해커가 아닌 사람들은 잘 모르겠지만, 대부분의 해커는 매우 경쟁적입니다.) 통계 분석을 시도했을 때, 그것이 제가 했던 것보다 훨씬 똑똑하다는 것을 즉시 발견했습니다. 물론 "virtumundo"나 "teens"와 같은 용어가 스팸의 좋은 지표라는 것을 알아냈습니다. 하지만 "per", "FL", "ff0000"도 좋은 스팸 지표라는 것을 발견했습니다. 사실, "ff0000"(HTML에서 밝은 빨간색을 의미)은 거의 모든 포르노 용어만큼이나 좋은 스팸 지표임이 밝혀졌습니다.

---

다음은 제가 통계적 필터링을 수행하는 방식의 개요입니다. 저는 스팸 코퍼스와 비스팸 메일 코퍼스로 시작합니다. 현재 각 코퍼스에는 약 4000개의 메시지가 있습니다. 각 코퍼스의 각 메시지에 대해 헤더와 포함된 HTML 및 JavaScript를 포함한 전체 텍스트를 스캔합니다.

현재 저는 알파벳 숫자, 대시, 아포스트로피, 달러 기호를 토큰의 일부로 간주하고, 그 외 모든 것을 토큰 구분 기호로 간주합니다. (이 부분은 개선의 여지가 있을 것입니다.) 저는 모두 숫자로 된 토큰을 무시하고, HTML 주석도 무시하여 토큰 구분 기호로도 고려하지 않습니다.

각 코퍼스에서 각 토큰의 발생 횟수를 (현재는 대소문자를 무시하고) 계산합니다. 이 단계에서 토큰을 키로, 발생 횟수를 값으로 하는 두 개의 큰 해시 테이블을 얻게 됩니다.

다음으로, 세 번째 해시 테이블을 생성하여 각 토큰에 대해 해당 토큰을 포함하는 이메일이 스팸일 확률을 매핑합니다. 이 확률은 다음과 같이 계산됩니다[^1]:

```lisp
(let ((g (* 2 (or (gethash word good) 0)))
      (b (or (gethash word bad) 0)))
   (unless (< (+ g b) 5)
     (max .01
          (min .99 (float (/ (min 1 (/ b nbad))
                             (+ (min 1 (/ g ngood))
                                (min 1 (/ b nbad)))))))))
```

여기서 `word`는 확률을 계산 중인 토큰이고, `good`과 `bad`는 첫 번째 단계에서 생성한 해시 테이블이며, `ngood`와 `nbad`는 각각 비스팸 및 스팸 메시지의 수입니다.

저는 오탐을 방지하기 위해 확률을 약간 편향시키고 싶습니다. 시행착오를 통해 `good`의 모든 숫자를 두 배로 만드는 것이 좋은 방법이라는 것을 발견했습니다. 이것은 합법적인 이메일에서 가끔 발생하는 단어와 거의 발생하지 않는 단어를 구별하는 데 도움이 됩니다. 저는 총 5회 이상 발생하는 단어만 고려합니다 (실제로, 두 배로 계산하기 때문에 비스팸 메일에서 3회만 발생해도 충분합니다). 그리고 한 코퍼스에는 존재하지만 다른 코퍼스에는 없는 단어에 어떤 확률을 부여할지에 대한 질문이 있습니다. 다시 시행착오를 통해 0.01과 0.99를 선택했습니다. 이 부분은 조정할 여지가 있지만, 코퍼스가 커짐에 따라 이러한 조정은 어쨌든 자동으로 이루어질 것입니다.

특히 통찰력 있는 독자라면, 각 코퍼스를 텍스트의 긴 단일 스트림으로 간주하여 발생 횟수를 계산하면서, 스팸 확률을 계산할 때 결합된 길이 대신 각 코퍼스의 메시지 수를 제수로 사용한다는 점을 알아차릴 것입니다. 이것은 오탐을 방지하기 위한 또 다른 약간의 편향을 추가합니다.

새로운 메일이 도착하면 토큰으로 스캔되고, 스팸 확률이 중립적인 0.5에서 얼마나 벗어났는지 측정하여 가장 흥미로운 15개 토큰을 사용하여 해당 메일이 스팸일 확률을 계산합니다. `probs`가 15개의 개별 확률 목록이라면, `combined` 확률은 다음과 같이 계산됩니다:

```lisp
(let ((prod (apply #'* probs)))
  (/ prod (+ prod (apply #'* (mapcar #'(lambda (x)
                                         (- 1 x))
                                     probs)))))
```

실제로 발생하는 질문 중 하나는 이전에 본 적 없는 단어, 즉 단어 확률 해시 테이블에 없는 단어에 어떤 확률을 부여해야 하는가 하는 것입니다. 다시 시행착오를 통해 0.4가 좋은 숫자임을 발견했습니다. 이전에 단어를 본 적이 없다면, 아마도 상당히 무해할 것입니다. 스팸 단어는 너무 익숙한 경향이 있습니다.

이 알고리즘이 실제 이메일에 적용된 예시는 마지막 부록에 있습니다.

저는 알고리즘이 스팸일 확률을 0.9 이상으로 주는 메일을 스팸으로 처리합니다. 하지만 실제로는 이 임계값을 어디에 두든 크게 중요하지 않을 것입니다. 왜냐하면 확률이 중간 범위에 도달하는 경우는 거의 없기 때문입니다.

---

통계적 접근 방식의 한 가지 큰 장점은 스팸을 많이 읽을 필요가 없다는 것입니다. 지난 6개월 동안 말 그대로 수천 건의 스팸을 읽었고, 솔직히 좀 사기가 저하됩니다. 노버트 위너는 노예와 경쟁하면 노예가 된다고 말했습니다. 스패머들과 경쟁하는 것에는 비슷하게 비열한 점이 있습니다. 개별 스팸 특징을 인식하려면 스패머의 마음에 들어가려고 노력해야 하는데, 솔직히 스패머의 마음속에 가능한 한 적게 머물고 싶습니다.

하지만 베이지안 접근 방식의 진정한 이점은 물론, 당신이 무엇을 측정하고 있는지 정확히 알고 있다는 것입니다. SpamAssassin과 같은 특징 인식 필터는 이메일에 스팸 "점수"를 할당합니다. 베이지안 접근 방식은 실제 확률을 할당합니다. "점수"의 문제는 아무도 그것이 무엇을 의미하는지 모른다는 것입니다. 사용자는 그것이 무엇을 의미하는지 모르지만, 더 나쁜 것은 필터 개발자조차도 모른다는 것입니다. "sex"라는 단어가 포함된 이메일에 몇 점을 주어야 할까요? 확률은 물론 잘못될 수 있지만, 그것이 무엇을 의미하는지, 또는 확률을 계산하기 위해 증거를 어떻게 결합해야 하는지에 대한 모호함은 거의 없습니다. 제 코퍼스를 기반으로 "sex"는 포함된 이메일이 스팸일 확률이 0.97임을 나타내고, "sexy"는 0.99의 확률을 나타냅니다. 그리고 마찬가지로 모호함이 없는 베이즈 정리(Bayes' Rule)에 따르면, 두 단어를 모두 포함하는 이메일은 (가능성이 낮지만) 다른 증거가 없는 한 99.97%의 확률로 스팸이 될 것입니다.

확률을 측정하기 때문에 베이지안 접근 방식은 이메일의 모든 증거, 즉 좋고 나쁜 증거 모두를 고려합니다. 스팸에서 드물게 발생하는 단어("though", "tonight", "apparently"와 같은)는 "unsubscribe"나 "opt-in"과 같은 나쁜 단어가 확률을 높이는 것만큼이나 확률을 낮추는 데 기여합니다. 따라서 우연히 "sex"라는 단어를 포함하는 평범한 이메일이 스팸으로 표시되지는 않을 것입니다.

이상적으로는 물론 각 사용자별로 개별적으로 확률을 계산해야 합니다. 저는 "Lisp"라는 단어를 포함하는 이메일을 많이 받지만, (지금까지) 스팸은 없습니다. 따라서 그러한 단어는 저에게 메일을 보내는 일종의 비밀번호 역할을 합니다. 제 이전 스팸 필터링 소프트웨어에서는 사용자가 그러한 단어 목록을 설정할 수 있었고, 해당 단어를 포함하는 메일은 자동으로 필터를 통과했습니다. 제 목록에는 "Lisp"와 제 우편번호를 넣어서 (그렇지 않으면 꽤 스팸처럼 들리는) 온라인 주문 영수증이 통과되도록 했습니다. 저는 제가 매우 똑똑하다고 생각했지만, 베이지안 필터가 저에게 똑같은 일을 해주었고, 게다가 제가 생각하지 못했던 많은 단어들을 발견했습니다.

시작할 때 우리 필터가 1000건당 5건 미만의 스팸을 0건의 오탐으로 통과시킨다고 말했을 때, 저는 제 메일을 제 메일 코퍼스를 기반으로 필터링하는 것에 대해 말하는 것입니다. 하지만 이 수치는 오해의 소지가 없습니다. 왜냐하면 이것이 제가 옹호하는 접근 방식이기 때문입니다: 각 사용자의 메일을 그가 받는 스팸 및 비스팸 메일을 기반으로 필터링하는 것입니다. 본질적으로 각 사용자는 일반 삭제와 스팸으로 삭제의 두 가지 삭제 버튼을 가져야 합니다. 스팸으로 삭제된 것은 스팸 코퍼스로 들어가고, 나머지는 비스팸 코퍼스로 들어갑니다.

사용자에게 초기 필터(seed filter)를 제공할 수 있지만, 궁극적으로 각 사용자는 실제로 받는 메일을 기반으로 자신만의 단어별 확률을 가져야 합니다. 이것은 (a) 필터를 더 효과적으로 만들고, (b) 각 사용자가 스팸에 대한 자신의 정확한 정의를 내릴 수 있게 하며, (c) 아마도 가장 좋은 점은 스패머가 필터를 통과하도록 메일을 조정하는 것을 어렵게 만든다는 것입니다. 필터의 많은 부분이 개별 데이터베이스에 있다면, 초기 필터를 통과하도록 스팸을 조정하는 것만으로는 개별 사용자의 다양하고 훨씬 더 훈련된 필터를 얼마나 잘 통과할지에 대한 보증이 되지 않습니다.

콘텐츠 기반 스팸 필터링은 종종 화이트리스트(whitelist)와 함께 사용됩니다. 화이트리스트는 필터링 없이 메일을 수락할 수 있는 발신자 목록입니다. 이러한 화이트리스트를 구축하는 쉬운 방법 중 하나는 사용자가 보낸 메일 주소 목록을 유지하는 것입니다. 만약 메일 리더에 스팸으로 삭제하는 버튼이 있다면, 일반적인 휴지통으로 삭제된 모든 이메일의 발신자 주소를 추가할 수도 있습니다.

저는 화이트리스트를 지지하지만, 필터링 개선보다는 계산량 절약을 위한 방법으로 더 많이 사용합니다. 저는 화이트리스트가 필터링을 더 쉽게 만들 것이라고 생각했습니다. 왜냐하면 들어본 적 없는 사람들의 이메일만 필터링하면 되고, 처음으로 메일을 보내는 사람은 말하는 내용에 있어 관습에 제약을 받기 때문입니다. 이미 아는 사람이라면 성적인 내용을 이야기하는 이메일을 보낼 수도 있지만, 처음으로 메일을 보내는 사람은 그렇지 않을 것입니다. 문제는 사람들이 여러 개의 이메일 주소를 가질 수 있다는 것이므로, 새로운 발신자 주소가 발신자가 처음으로 당신에게 연락하는 것이라고 보장하지는 않습니다.

오래된 친구 (특히 해커인 경우)가 갑자기 새 발신자 주소로 이메일을 보내는 것은 드문 일이 아니므로, 알 수 없는 발신자로부터의 메일을 특히 엄격하게 필터링함으로써 오탐 위험을 감수할 수는 없습니다.

어떤 의미에서는 제 필터가 전체 메시지, 헤더를 포함하여 기반으로 하기 때문에 일종의 화이트리스트(및 블랙리스트)를 자체적으로 구현하고 있습니다. 그런 의미에서 신뢰할 수 있는 발신자의 이메일 주소, 심지어 그들로부터 저에게 메일이 도착하는 경로까지 "알고" 있습니다. 그리고 스팸에 대해서도 서버 이름, 메일러 버전, 프로토콜을 포함하여 동일한 정보를 알고 있습니다.

---

만약 제가 현재의 스팸 필터링 속도를 유지할 수 있다고 생각한다면, 이 문제를 해결되었다고 간주할 것입니다. 하지만 현재 대부분의 스팸을 걸러낼 수 있다는 것은 큰 의미가 없습니다. 왜냐하면 스팸은 진화하기 때문입니다.

실제로 지금까지 대부분의 안티스팸 기술은 새로운 저항성 벌레 균주를 만들어내는 것과 같은 살충제와 같았습니다. 저는 베이지안 필터에 대해 더 희망적입니다. 왜냐하면 필터가 스팸과 함께 진화하기 때문입니다. 따라서 스패머들이 단순한 단어 기반의 스팸 필터를 피하기 위해 "cock" 대신 "c0ck"를 사용하기 시작하면, 베이지안 필터는 자동으로 이를 인지합니다. 실제로 "c0ck"는 "cock"보다 훨씬 더 결정적인 증거이며, 베이지안 필터는 그것이 얼마나 더 결정적인 증거인지 정확히 알고 있습니다.

하지만 스팸 필터링 계획을 제안하는 사람은 누구나 다음과 같은 질문에 답할 수 있어야 합니다: 만약 스패머들이 당신이 무엇을 하고 있는지 정확히 알고 있다면, 그들은 당신을 얼마나 잘 통과할 수 있을까요? 예를 들어, 체크섬 기반 스팸 필터링이 심각한 장애물이 된다면, 스패머들은 메시지 본문을 생성하기 위해 매드립(mad-lib) 기법으로 전환할 것이라고 생각합니다.

베이지안 필터를 이기기 위해서는 스패머들이 자신들의 이메일을 고유하게 만들거나 개별적인 나쁜 단어 사용을 중단하는 것만으로는 충분하지 않을 것입니다. 그들은 자신의 메일을 평범한 메일과 구별할 수 없도록 만들어야 합니다. 그리고 이것이야말로 그들을 심각하게 제약할 것이라고 생각합니다. 스팸은 대부분 판매 제안입니다. 따라서 당신의 일반 메일이 모두 판매 제안이 아니라면, 스팸은 필연적으로 다른 특성을 가질 것입니다. 또한 스패머들은 물론 전체 인프라를 변경하고 계속 변경해야 할 것입니다. 그렇지 않으면 메시지 본문에 대해 무엇을 하든 헤더는 여전히 베이지안 필터에 나쁘게 보일 것이기 때문입니다. 저는 스패머들이 사용하는 인프라에 대해 충분히 알지 못해 헤더를 평범하게 보이게 만드는 것이 얼마나 어려운지 모르지만, 제 추측으로는 메시지를 평범하게 보이게 만드는 것보다 훨씬 더 어려울 것입니다.

헤더 문제 해결에 성공한다고 가정할 때, 미래의 스팸은 아마도 다음과 같이 보일 것입니다:

"안녕. 다음을 확인해봐.
http://www.27meg.com/foo
왜냐하면 콘텐츠 기반 필터링이 스패머에게 남기는 판매 제안의 양은 이 정도가 전부이기 때문이다. (사실, 이마저도 필터를 통과시키기 어려울 것이다. 왜냐하면 이메일의 다른 모든 것이 중립적이라면, 스팸 확률은 URL에 달려있을 것이고, 그것을 중립적으로 보이게 만드는 데는 노력이 필요할 것이기 때문이다.)"

스패머들은 정체성을 숨기지 않는 소위 "옵트인" 목록을 운영하는 사업체부터 포르노 사이트를 홍보하는 스팸을 보내기 위해 메일 서버를 납치하는 사람들까지 다양합니다. 우리가 필터링을 사용하여 그들의 선택 사항을 위의 메일과 같은 것으로 좁힌다면, 그것은 스펙트럼의 "합법적인" 끝에 있는 스패머들을 거의 사업에서 내쫓을 것입니다. 그들은 자신의 스팸이 왜 스팸이 아닌지에 대한 설명과 "구독"을 취소하는 방법에 대한 상투적인 문구를 포함해야 할 의무를 느끼는데, 그런 종류의 텍스트는 인식하기 쉽습니다.

(저는 이전에는 더 엄격한 법률이 스팸을 감소시킬 것이라고 믿는 것이 순진하다고 생각했습니다. 이제는 더 엄격한 법률이 스패머들이 보내는 스팸의 양을 줄이지는 못할지라도, 수신자가 실제로 보는 스팸의 양을 줄이는 데 필터가 확실히 도움이 될 수 있다고 생각합니다.)

스패머들이 할 수 있는 판매 제안을 제한하면, 필연적으로 그들을 사업에서 내쫓는 경향이 있을 것입니다. "사업"이라는 단어는 기억해야 할 중요한 단어입니다. 스패머들은 사업가입니다. 그들은 스팸이 효과가 있기 때문에 스팸을 보냅니다. 응답률이 끔찍하게 낮음에도 불구하고 (최상의 경우 백만 명당 15건, 카탈로그 우편 발송의 백만 명당 3000건 대비), 그들에게 드는 비용은 거의 없습니다. 스팸을 삭제하는 데 1초를 소비하는 백만 명의 수신자당 약 5인주(man-weeks)의 비용이 들지만, 스패머는 그 비용을 지불할 필요가 없습니다.

스팸을 보내는 데는 스패머에게도 어느 정도 비용이 듭니다.[2] 따라서 우리가 응답률을 낮출수록 (필터링을 통해서든, 필터를 사용하여 스패머가 홍보 문구를 희석하도록 강제함으로써든) 더 적은 사업체들이 스팸을 보내는 것이 가치 있다고 생각할 것입니다.

스패머들이 사용하는 판매 제안의 종류는 응답률을 높이기 위해서입니다. 이것은 스패머의 마음에 들어가는 것보다 훨씬 더 역겨울 수 있지만, 스팸에 응답하는 사람의 마음을 잠깐 들여다봅시다. 이 사람은 놀랍도록 순진하거나 성적 관심사에 대해 깊은 부정을 하고 있는 사람입니다. 어느 쪽이든, 우리에게는 혐오스럽거나 어리석게 보이는 스팸이라도 그들에게는 흥미로운 것입니다. 스패머들은 그것이 흥미롭게 들리지 않는다면 그런 말을 하지 않을 것입니다. 그리고 "다음 것을 확인해봐야 한다고 생각했다"는 문구는 스팸 수신자에게 스패머들이 지금 하는 말만큼의 매력이 없을 것입니다.

결과: 흥미로운 판매 제안을 포함할 수 없다면, 스팸은 마케팅 수단으로서 덜 효과적이 되고, 더 적은 사업체가 사용하기를 원할 것입니다.

궁극적으로 그것이 큰 승리입니다. 저는 스팸을 보지 않기 위해 스팸 필터링 소프트웨어를 작성하기 시작했습니다. 하지만 우리가 스팸을 필터링하는 데 충분히 능숙해진다면, 그것은 효과가 없을 것이고, 스팸을 보내는 것을 실제로 중단할 것입니다.

---

스팸 퇴치 접근 방식 중에서 소프트웨어부터 법률까지 모든 것을 고려할 때, 저는 베이지안 필터링이 가장 효과적인 단일 방법이 될 것이라고 믿습니다. 하지만 스팸 방지 노력의 종류가 다양할수록 더 좋다고 생각합니다. 왜냐하면 스패머를 제약하는 모든 조치는 필터링을 더 쉽게 만드는 경향이 있기 때문입니다. 그리고 콘텐츠 기반 필터링의 세계 내에서도 동시에 사용되는 다양한 종류의 소프트웨어가 있는 것이 좋다고 생각합니다. 필터가 다양할수록 스패머가 스팸을 조정하여 통과시키기가 더 어려워질 것입니다.

### 부록: 필터링 예시

이 글을 쓰는 동안 도착한 스팸의 예시입니다. 이 스팸에서 가장 흥미로운 15개 단어는 다음과 같습니다:

qvp0045
indira
mx-05
intimail
$7500
freeyankeedom
cdo
bluefoxmedia
jpg
unsecured
platinum
3d0
qves
7c5
7c266675

이 단어들은 헤더와 메시지 본문에서 나온 내용들이 혼합되어 있는데, 이는 스팸의 전형적인 모습입니다. 또한 스팸의 전형적인 모습은 이 단어들 각각이 제 데이터베이스에서 0.99의 스팸 확률을 가지고 있다는 것입니다. 사실 0.99의 확률을 가진 단어가 15개 이상이며, 이것들은 발견된 첫 15개일 뿐입니다.

안타깝게도 이것은 베이즈 정리(Bayes' Rule) 사용에 있어 지루한 예시입니다. 흥미로운 확률의 다양성을 보려면 이 꽤 특이한 스팸을 봐야 합니다.

이 스팸에서 가장 흥미로운 15개 단어와 그 확률은 다음과 같습니다:

madam           0.99
promotion       0.99
republic        0.99
shortest        0.047225013
mandatory       0.047225013
standardization 0.07347802
sorry           0.08221981
supported       0.09019077
people's        0.09019077
enter           0.9075001
quality         0.8921298
organization    0.12454646
investment      0.8568143
very            0.14758544
valuable        0.82347786

이번에는 좋은 증거와 나쁜 증거가 혼합되어 있습니다. "shortest"와 같은 단어는 "madam"이나 "promotion"과 같은 단어가 유죄를 나타내는 것만큼이나 무죄를 나타내는 증거입니다. 하지만 여전히 유죄 쪽이 더 강력합니다. 이 숫자들을 베이즈 정리(Bayes' Rule)에 따라 결합하면 결과 확률은 0.9027입니다.

"Madam"은 명백히 "Dear Sir or Madam."으로 시작하는 스팸에서 온 것입니다. 흔하지는 않지만, "madam"이라는 단어는 제 정상적인 이메일에는 전혀 나타나지 않으며, 이는 비율에 관한 것입니다.

"Republic"은 나이지리아 사기 이메일에 자주 등장하고, 한국과 남아프리카에 관한 스팸에서도 한두 번 나타나기 때문에 높은 점수를 받습니다. 이것이 이 스팸을 식별하는 데 도움이 되는 것은 우연이라고 말할 수 있습니다. 하지만 스팸 확률을 검토할 때 이러한 "사고"가 많이 발생하며, 그들은 잘못된 방향보다는 올바른 방향으로 상황을 이끄는 놀라운 경향이 있다는 것을 발견했습니다. 이 경우, "Republic"이라는 단어가 나이지리아 사기 이메일과 이 스팸에 나타나는 것은 전적으로 우연이 아닙니다. 개발도상국과 관련된 의심스러운 사업 제안의 전체 부류가 있으며, 이는 다시 국가 이름에 공화국임을 명시적으로 지정하는 (그렇지 않음에도 불구하고) 경향이 있습니다.[3]

반면에 "enter"는 실제 오탐입니다. 주로 구독 취소 지침에 나타나지만, 여기서는 완전히 무해한 방식으로 사용되었습니다. 다행히 통계적 접근 방식은 상당히 견고하며, 결과가 흐트러지기 전에 상당한 수의 오탐을 견딜 수 있습니다.

비교를 위해, 필터를 통과하는 드문 새, 즉 스팸의 예시입니다. 왜 그럴까요? 순전히 우연히도 제 실제 이메일에 나타나는 단어들로 가득 차 있기 때문입니다:

perl       0.01
python     0.01
tcl        0.01
scripting  0.01
morris     0.01
graham     0.01491078
guarantee  0.9762507
cgi        0.9734398
paul       0.027040077
quite      0.030676773
pop3       0.042199217
various    0.06080265
prices     0.9359873
managed    0.06451222
difficult  0.071706355

여기에는 몇 가지 좋은 소식이 있습니다. 첫째, 이 메일은 아마도 프로그래밍 언어에 전문성이 있고 Morris라는 좋은 친구가 있는 사람의 필터를 통과하지 못했을 것입니다. 평균적인 사용자에게는 여기에 있는 상위 5개 단어 모두 중립적이며 스팸 확률에 기여하지 않을 것입니다. 둘째, 단어 쌍 기반 필터링(아래 참조)은 이 메일을 포착할 수 있을 것이라고 생각합니다: "cost effective", "setup fee", "money back" -- 상당히 기소적인 내용입니다. 물론 그들이 계속해서 저에게 (또는 제가 속한 네트워크에) 스팸을 보낸다면, "Hostex" 자체도 스팸 용어로 인식될 것입니다.

마지막으로, 정상적인 이메일입니다. 가장 흥미로운 15개 단어는 다음과 같습니다:

continuation  0.01
describe      0.01
continuations 0.01
example       0.033600237
programming   0.05214485
i'm           0.055427782
examples      0.07972858
color         0.9189189
localhost     0.09883721
hi            0.116539136
california    0.84421706
same          0.15981844
spot          0.1654587
us-ascii      0.16804294
what          0.19212411

여기 단어 대부분은 메일이 정상적인 것임을 나타냅니다. "color"(스패머들은 색깔 있는 글꼴을 좋아합니다)와 "California"(증언과 양식의 메뉴에 나타남)라는 두 개의 좋지 않은 징후가 있는 단어가 있지만, "continuation"이나 "example"과 같이 명백히 정상적인 단어를 상쇄하기에는 충분하지 않습니다.

"describe"가 그렇게 철저히 정상적으로 평가된다는 것은 흥미롭습니다. 제 4000건의 스팸 중 단 한 건에서도 나타나지 않았습니다. 데이터는 이와 같은 놀라운 사실로 가득 차 있습니다. 스팸 텍스트를 분석할 때 배우는 것 중 하나는 스패머들이 언어의 매우 좁은 하위 집합에서 활동한다는 것입니다. 바로 그 사실과 함께 개별 사용자의 메일의 똑같이 특징적인 어휘가 베이지안 필터링을 좋은 선택으로 만드는 것입니다.

### 부록: 추가 아이디어

아직 시도해보지 않은 아이디어 하나는 개별 단어가 아닌 단어 쌍, 또는 심지어 단어 세 쌍을 기반으로 필터링하는 것입니다. 이것은 확률에 대한 훨씬 더 정확한 추정치를 제공해야 합니다. 예를 들어, 제 현재 데이터베이스에서 "offers"라는 단어는 0.96의 확률을 가지고 있습니다. 만약 단어 쌍을 기반으로 확률을 계산한다면, "special offers"와 "valuable offers"는 각각 0.99의 확률을 가질 것이고, "approach offers"(예: "this approach offers")는 0.1 이하의 확률을 가질 것입니다.

제가 이것을 하지 않은 이유는 개별 단어를 기반으로 한 필터링이 이미 매우 잘 작동하기 때문입니다. 하지만 스팸 감지가 더 어려워진다면 필터를 강화할 여지가 있다는 것을 의미합니다. (흥미롭게도, 단어 쌍 기반 필터는 역방향으로 실행되는 마르코프 연쇄 텍스트 생성기 역할을 할 것입니다.)

개별 스팸 특징(예: 수신자의 주소가 'to:' 필드에 보이지 않는 것)은 물론 스팸 인식에 가치가 있습니다. 이러한 특징은 가상 단어로 취급하여 이 알고리즘에 고려될 수 있습니다. 아마도 미래 버전에서는, 적어도 가장 악의적인 스팸 지표 몇 가지에 대해 이렇게 할 것입니다. 특징 인식 스팸 필터는 많은 세부 사항에서는 올바르지만, 증거를 결합하는 전반적인 체계가 부족합니다.

정상 메일 특징을 인식하는 것이 스팸 특징을 인식하는 것보다 더 중요할 수 있습니다. 오탐은 너무 걱정되어서 특별한 조치를 요구합니다. 미래 버전에서는 오탐을 피하기 위해 특별히 고안된 두 번째 수준의 테스트를 추가할 가능성이 높습니다. 만약 메일이 이 두 번째 수준의 필터를 트리거한다면, 스팸 확률이 임계값 이상이더라도 수락될 것입니다. 저는 이 두 번째 수준의 필터링이 베이지안 방식이 될 것으로 기대하지 않습니다. 왜냐하면 오탐의 수가 패턴을 알아차릴 만큼 충분히 크지 않을 것이기 때문에, 필연적으로 임시방편적이고 추측에 기반하게 될 것입니다. (어차피 백업 시스템이 주 시스템과 동일한 기술에 의존하지 않는 것이 좋습니다.)

제가 미래에 시도할 또 다른 것은 이메일의 특정 부분에 추가적인 주의를 기울이는 것입니다. 예를 들어, 현재 스팸의 약 95%는 방문하려는 사이트의 URL을 포함합니다. (나머지 5%는 전화번호로 전화하거나, 이메일로 회신하거나, 미국 우편 주소로 보내거나, 몇몇 경우에는 특정 주식을 구매하라고 합니다.) 이러한 경우 URL 자체만으로도 이메일이 스팸인지 여부를 결정하기에 충분합니다.

도메인 이름은 (독일어가 아닌) 이메일의 나머지 텍스트와 달리 여러 단어가 붙어 있는 경우가 많다는 점에서 다릅니다. 일반적인 경우에는 계산 비용이 많이 들지만, 분해를 시도해 볼 가치가 있을 수 있습니다. 만약 필터가 이전에 "xxxporn" 토큰을 본 적이 없다면 0.4의 개별 스팸 확률을 가지겠지만, "xxx"와 "porn"은 각각 0.9889와 0.99의 확률을 가지며 결합 확률은 0.9998입니다. URL에 IP 주소가 포함된 경우 (물론 몇몇 시스템 관리자의 메일을 제외하고는) 매우 결정적인 징후입니다.

스패머들이 메시지 텍스트에 결정적인 단어를 사용하는 것을 점차 중단하도록 강요함에 따라 도메인 이름 분해가 더 중요해질 것으로 예상합니다.

스패머가 홍보하는 의심스러운 URL 목록을 협력적으로 유지하는 것이 좋을 수 있습니다. 악의적이거나 무능한 제출을 방지하기 위해 Raph Levien이 연구한 신뢰도 측정(trust metric) 유형이 필요하겠지만, 그러한 것이 있다면 어떤 필터링 소프트웨어에도 도움이 될 것입니다. 또한 보이콧의 편리한 기반이 될 것입니다.

의심스러운 URL을 테스트하는 또 다른 방법은 사용자가 이메일을 보기 전에 해당 사이트를 확인하기 위해 크롤러를 보내는 것입니다. 이메일을 평가하는 것과 마찬가지로 사이트를 평가하기 위해 베이지안 필터를 사용할 수 있으며, 사이트에서 발견된 내용은 이메일이 스팸일 확률을 계산하는 데 포함될 수 있습니다. 리디렉션되는 URL은 물론 특히 의심스러울 것입니다.

제가 생각하기에 정말 좋은 협력 프로젝트는 거대한 스팸 코퍼스를 축적하는 것입니다. 크고 깨끗한 코퍼스는 베이지안 필터링을 잘 작동하게 하는 열쇠입니다. 베이지안 필터는 실제로 코퍼스를 입력으로 사용할 수 있습니다. 하지만 그러한 코퍼스는 다른 종류의 필터에도 유용할 것입니다. 왜냐하면 그것을 사용하여 테스트할 수 있기 때문입니다.

그러한 코퍼스를 만드는 것은 몇 가지 기술적인 문제를 안고 있습니다. 물론 악의적이거나 무능한 제출을 방지하기 위해 신뢰도 측정(trust metric)이 필요합니다. 또한 코퍼스의 메일에서 개인 정보(수신자 주소 및 참조 주소뿐만 아니라, 종종 수신자 주소를 인코딩하는 구독 URL의 인수와 같은 것들도)를 삭제할 방법도 필요합니다. 누군가 이 프로젝트를 맡고 싶다면, 그것은 세상을 위해 좋은 일이 될 것입니다.

### 부록: 스팸 정의

스팸에 대한 대략적인 합의가 있다고 생각하지만, 명시적인 정의를 갖는 것이 유용할 것입니다. 중앙 스팸 코퍼스를 설정하거나 스팸 필터링 비율을 의미 있게 비교하려면 이렇게 해야 합니다.

우선, 스팸은 원치 않는 상업용 이메일이 아닙니다. 만약 제 이웃에서 제가 좋은 상태의 오래된 Raleigh 세단 자전거를 찾고 있다는 것을 알게 되고, 그것을 팔겠다는 제안 이메일을 보낸다면, 저는 기쁠 것입니다. 하지만 이 이메일은 상업적이고 원치 않는 것일 것입니다. 스팸을 정의하는 특징(사실, 그것의 존재 이유)은 그것이 원치 않는다는 것이 아니라 그것이 자동화된다는 것입니다. 또한, 스팸이 보통 상업적이라는 것은 단지 우연일 뿐입니다. 만약 누군가가 정치적 대의를 지지하기 위해 대량 이메일을 보내기 시작한다면, 그것은 포르노 사이트를 홍보하는 이메일만큼이나 스팸이 될 것입니다.

저는 스팸을 "원치 않는 자동화된 이메일(unsolicited automated email)"로 정의할 것을 제안합니다.

따라서 이 정의는 많은 법적 스팸 정의에는 포함되지 않는 일부 이메일을 포함합니다. 스팸의 법적 정의는 아마도 로비스트의 영향을 받아, 수신자와 "기존 관계"를 가진 회사에서 보낸 메일을 제외하는 경향이 있습니다. 하지만 예를 들어 회사에서 물건을 구매했다고 해서 그들로부터 지속적인 이메일을 원한다는 의미는 아닙니다.

온라인 상점에서 물건을 주문하고, 그들이 스트림으로 스팸을 보내면, 그것은 여전히 스팸입니다.

스팸을 보내는 회사들은 종종 "구독 취소" 방법을 제공하거나, 스팸을 받지 않으려면 "계정 환경설정"을 변경하기 위해 사이트로 이동하라고 요청합니다. 이것만으로는 메일이 스팸이 되는 것을 막기에 충분하지 않습니다. 옵트아웃하지 않는 것이 옵트인하는 것과 같지는 않습니다. 수신자가 명확하게 표시된 상자를 선택하지 않는 한 (기본값이 아니오였음), 그것은 스팸입니다.

일부 비즈니스 관계에서는 특정 종류의 메일을 암묵적으로 요청합니다. 온라인으로 주문할 때, 영수증과 주문 배송 시 알림을 암묵적으로 요청한다고 생각합니다.

Verisign이 도메인 이름이 만료될 것이라는 경고 메일을 보낼 때 (적어도 그들이 실제 등록 기관이라면) 저는 괜찮습니다. 하지만 Verisign이 "E-Commerce 웹 사이트 구축 무료 가이드"를 제공하는 이메일을 보내면, 그것은 스팸입니다.

감사합니다.
Sarah Harlin은 이 글의 초안을 읽어주었고, Daniel Giffin (또한 생산적인 Arc 인터프리터를 작성 중임)은 필터링에 대한 몇 가지 좋은 아이디어와 우리의 메일 인프라를 구축해주었습니다. spam에 대한 많은 토론을 해준 Robert Morris, Trevor Blackwell, Erann Gat, 신뢰도 측정에 대한 조언을 해준 Raph Levien, 통계에 대한 조언을 해준 Chip Coldwell와 Sam Steingold에게 감사합니다.

[^1]: 이 글의 예시는 믿거나 말거나 더 쉬운 접근을 위해 Common Lisp로 번역되었습니다. 여기서 설명하는 응용 프로그램은 아직 출시되지 않은 Arc라는 새로운 Lisp 방언을 테스트하기 위해 작성한 것입니다.
[^2]: 현재 백만 건의 스팸을 보내는 데 드는 가장 저렴한 비용은 약 200달러입니다. 이는 스팸당 1/50센트로 매우 저렴합니다. 하지만 예를 들어 스팸의 95%를 필터링하면 특정 잠재 고객에게 도달하는 데 드는 스패머의 비용이 20배 증가합니다. 그 비용을 감당할 수 있는 마진을 가진 사람은 거의 없을 것입니다.
[^3]: 경험 법칙상, 국가 이름 앞에 qualifiers가 많을수록 통치자가 부패합니다. X의 사회주의 인민 민주 공화국과 같은 국가는 아마도 당신이 살고 싶지 않은 세상의 마지막 장소일 것입니다.

더 많은 정보: